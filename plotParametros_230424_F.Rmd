---
title: "Plot A10"
---
Analisis del A10 intra-prueba (intra-día)
```{r}
library(usethis)
library(ggplot2)
library(dplyr)
library(credentials)

# Para no tener que volver a tipear user/pwd en git: In the shell, enter 
# git config --global credential.helper 'cache --timeout=10000000' 
# to store your password # for # ten million seconds (that’s roughly 16 weeks).

# Plot A10 vs prueba, color según muestra, forma según activación
ggplot(subset_data, aes(x = Prueba, y =`A10 (600s+CT) [Pa]`, color = Muestra, shape = Activacion)) +
  geom_point(size = 3) +
  geom_point() +
  #scale_x_continuous(limits = c(0, 2000)) +
  #scale_y_continuous(limits = c(0, 1000)) +
  labs(x = "Pruebas", y = "A10") +
  ggtitle("A10 vs. Mediciones, coloreado por muestra") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5))

#------- analisis del A10 intra-prueba (intra-día)---------

# calculate CV values for each group
cv_data <- subset_data %>%
  group_by(Prueba) %>%
  summarise(cv = round(100*sd(`A10 (600s+CT) [Pa]`)/mean(`A10 (600s+CT) [Pa]`), 0))

#para calcular el N de cada grupo/prueba
N_data <- subset_data %>%
  count(Prueba, name = "N")

# plot boxplot with CV and N labels
ggplot(subset_data, aes(x = Prueba, y = `A10 (600s+CT) [Pa]`, color = Muestra)) +
  geom_boxplot() +
  labs(x = "Prueba", y = "A10") +
  ggtitle("A10 boxplot vs pruebas (con N y CV%)") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5)) +
  geom_text(data = N_data, aes(x = Prueba, y = min(subset_data$`A10 (600s+CT) [Pa]`), label = paste0("", N)), vjust = -1, size = 3, color = "red") +
  geom_text(data = cv_data, aes(x = Prueba, y = min(subset_data$`A10 (600s+CT) [Pa]`), label = paste0("", cv, "%")), vjust = 1, angle =55, size = 3, color = "blue", nudge_x = -0.2)

# tabla con CV y N por prueba (intra-día)
CV_N_intra_día <- merge(cv_data, N_data, "Prueba")
```


Variación inter-día para cada muestra
```{r}
#Variación inter-día para cada muestra
# calculate CV values for each group
cv_muestra <- subset_data %>%
  group_by(Muestra) %>%
  summarise(cv = round(100*sd(`A10 (600s+CT) [Pa]`)/mean(`A10 (600s+CT) [Pa]`), 0))

#para calcular el N de caja grupo/prueba
library(dplyr)

N_muestra <- subset_data %>%
  count(Muestra, name = "N")

#box plot con CV y N
ggplot(subset_data, aes(x = Muestra, y = `A10 (600s+CT) [Pa]`)) +
  geom_boxplot() +
  labs(x = "Muestra", y = "A10") +
  ggtitle("A10 boxplot vs Muestra (con N y CV%)") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.7)) +
  geom_text(data = N_muestra, aes(x = N_muestra$Muestra, y = max(subset_data$`A10 (600s+CT) [Pa]`), label = paste0("", N)), vjust = 0, size = 3, color = "red") +
  geom_text(data = cv_muestra, aes(x = Muestra, y = max(subset_data$`A10 (600s+CT) [Pa]`), label = paste0("", cv, "%")), vjust = 0, angle =0, size = 3, color = "blue", nudge_x = 0.25)

# tabla con CV y N por muestra (inter-día)
CV_N_inter_día <- merge(cv_muestra, N_muestra, "Muestra")
```


Variación inter-día por muestra solo para INTEM
```{r}
#subset de mediciones de INTEM
intem <- subset_data[subset_data$Activacion == "INTEM", ]

# calculate CV values for each group
cv_muestra_in <- intem %>%
  group_by(Muestra) %>%
  summarise(cv = round(100*sd(`A10 (600s+CT) [Pa]`)/mean(`A10 (600s+CT) [Pa]`), 0))

#para calcular el N de caja grupo/prueba
library(dplyr)

N_muestra_in <- intem %>%
  count(Muestra, name = "N")

#box plot con CV y N
ggplot(intem, aes(x = Muestra, y = `A10 (600s+CT) [Pa]`)) +
  geom_boxplot() +
  labs(x = "Muestra", y = "A10") +
  ggtitle("A10 de INTEM vs Muestra (con N y CV%)") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.7)) +
  geom_text(data = N_muestra_in, aes(x = Muestra, y = max(intem$`A10 (600s+CT) [Pa]`), label = paste0("", N)), vjust = 0, size = 3, color = "red") +
  geom_text(data = cv_muestra_in, aes(x = Muestra, y = max(intem$`A10 (600s+CT) [Pa]`), label = paste0("", cv, "%")), vjust = 0, angle =0, size = 3, color = "blue", nudge_x = 0.2)

# tabla con CV y N por muestra para INTEM (inter-día)
CV_N_inter_día_intem <- merge(cv_muestra_in, N_muestra_in, "Muestra")
```

Variación inter-día por muestra solo para EXTEM
```{r}
#subset de mediciones de EXTEM
extem <- subset_data[subset_data$Activacion == "EXTEM", ]

# calculate CV values for each group
cv_muestra_ex <- extem %>%
  group_by(Muestra) %>%
  summarise(cv = round(100*sd(`A10 (600s+CT) [Pa]`)/mean(`A10 (600s+CT) [Pa]`), 0))

#para calcular el N de caja grupo/prueba
library(dplyr)

N_muestra_ex <- extem %>%
  count(Muestra, name = "N")

# tabla con CV y N por muestra para EXTEM (inter-día)
CV_N_inter_día_extem <- merge(cv_muestra_ex, N_muestra_ex, "Muestra")

#box plot con CV y N
ggplot(extem, aes(x = Muestra, y = `A10 (600s+CT) [Pa]`)) +
  geom_boxplot() +
  labs(x = "Muestra", y = "A10") +
  ggtitle("A10 de EXTEM vs Muestra (con N y CV%)") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.7)) +
  geom_text(data = N_muestra_ex, aes(x = Muestra, y = max(extem$`A10 (600s+CT) [Pa]`), label = paste0("", N)), vjust = 0, size = 3, color = "red") +
  geom_text(data = cv_muestra_ex, aes(x = Muestra, y = max(extem$`A10 (600s+CT) [Pa]`), label = paste0("", cv, "%")), vjust = 0, angle =0, size = 3, color = "blue", nudge_x = 0.2)

```


CARTUCHOS: Plot A10 vs prueba, color nombre de cartucho
```{r}
#Plot A10 vs prueba, color nombre de cartucho

subset_data$`Nro Cartucho` <- as.character(subset_data$`Nro Cartucho`)

#plot
subset_data$Nro_Cartucho_Factor <- factor(subset_data$`Nro Cartucho`, levels = unique(subset_data$`Nro Cartucho`))

ggplot(subset_data, aes(x = Prueba, y =`A10 (600s+CT) [Pa]`, color = Nro_Cartucho_Factor)) + 
  labs(x = "Prueba", y = "A10") +
  geom_point(size = 2) +
  ggtitle("A10 vs. Pruebas coloreado según el cartucho") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5))

#CV y N intra-cartucho
cv_cartuchos <- subset_data %>%
  group_by(`Nro Cartucho`) %>%
  summarise(cv = round(100*sd(`A10 (600s+CT) [Pa]`)/mean(`A10 (600s+CT) [Pa]`), 0))

N_cartucho <- subset_data %>%
  count(`Nro Cartucho`, name = "N")

# tabla con CV y N por muestra para EXTEM (inter-día)
CV_N_cartuchos <- merge(cv_cartuchos, N_cartucho)

#box plot con CV y N
ggplot(subset_data, aes(x = subset_data$`Nro Cartucho`, y = `A10 (600s+CT) [Pa]`, color = Muestra)) +
  geom_boxplot() +
  labs(x = "Cartucho", y = "A10") +
  ggtitle("A10 intra Cartucho (con N y CV%)") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.7)) +
  geom_text(data = N_cartucho, aes(x = N_cartucho$`Nro Cartucho`, y = min(extem$`A10 (600s+CT) [Pa]`), label = paste0("", N)), vjust = 1, size = 3, color = "red") +
  geom_text(data = cv_cartuchos, aes(x = N_cartucho$`Nro Cartucho`, y = max(extem$`A10 (600s+CT) [Pa]`), label = paste0("", cv, "%")), vjust = 1, angle =55, size = 2, color = "blue", nudge_x = 0.2)

#subset de mediciones con datos de cartuchos, para eliminar los "NULL"
#????
```



PRESIÓN A CANAL CERRADO. Plot A10 vs prueba, coloreado según 3 rangos de QC1
```{r}
QC1_10 <- subset_data[subset_data$`Canal cerrado Promedio QC1 [Pa]`< 10000, ]
 
 # Cargar la paleta de colores de R
library(RColorBrewer)

# Crear los rangos
rangos_QC1 <- cut(subset_data$`Canal cerrado Promedio QC1 [Pa]`, breaks = c(0, 10000, 15000, 25000), labels = c("menor a 10000 Pa", "entre 10000 y 15000 Pa", "mayor a 15000 Pa"))

# Crear una paleta de colores
colores <- c("menor a 10000 Pa", "entre 10000 y 15000 Pa", "mayor a 15000 Pa")

#Plot A10 vs prueba, color según rango de QC1

ggplot(subset_data, aes(x = Prueba, y =`A10 (600s+CT) [Pa]`, col = colores[rangos_QC1])) +
  geom_point(size = 3) +
  labs(x = "Pruebas", y = "A10") +
  ggtitle("A10 vs. Prueba coloreado según rangos de QC1") +
  guides(colour = guide_legend(title = "Rangos QC1", title.position = "top", override.aes = list(size = 3))) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5))

```

Tabla y gráfico para analizar frecuencia y tipo de problemas
```{r}

problemas <- data.frame(table(my_data$Problema))
colnames(problemas) = c("Tipo de problema", "frecuencia")
problemas$frecuencia <- problemas$frecuencia*100/sum(problemas$frecuencia)

#gráfico de torta
library(ggplot2)
ggplot(problemas, aes(x="", y= frecuencia, fill=`Tipo de problema`)) +
  geom_col(width=1) +
  coord_polar("y", start=0) +
  ggtitle("Frecuencia de problemas") +
  guides(colour = guide_legend(title = "Tipo de problema", title.position = "top", override.aes = list(size = 3)))
  theme_void()

#gráfico de barras
ggplot(problemas, aes(x= `Tipo de problema`, y= `frecuencia`)) +
  geom_bar(stat="identity", fill="blue") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5)) +
  labs(x="Tipo de problema", y="Frecuencia", title="Distribución de tipos de problemas")
```


Correlación entre A10 y la diferencia de presión media (deltaPmed)
```{r}
#gráfico de todas las mediciones coloreadas por muestra
ggplot(subset_data, aes(x = `deltaPmed`, y =`A10 (600s+CT) [Pa]`, color = Muestra, shape = Activacion)) +
  geom_point(size = 2) +
  labs(x = "deltaPmed", y = "A10") +
  ggtitle("A10 vs. deltaPmed, coloreado por muestra") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 0, vjust = 0))

#gráfico de las mediciones realizadas con INTEM, coloreadas por muestra e identificadas según el comportamiento de la curva de presión media
ggplot(intem, aes(x = `deltaPmed`, y =`A10 (600s+CT) [Pa]`, color = Muestra, shape = `Comportamiento curva Pmed`)) +
  geom_point(size = 2) +
  labs(x = "deltaPmed", y = "A10") +
  ggtitle("A10 vs. deltaPmed para INTEM, coloreado por muestra, e identificado según 
          el comportamiento de la curva de presión media") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 0, vjust = 0))

#gráfico de A10 vs deltaPmed para mediciones realizadas con Plasma Siemens
sub_subset <- subset_data[subset_data$Muestra == "PLASMA SIEMENS", ]

ggplot(sub_subset, aes(x = `deltaPmed`, y =`A10 (600s+CT) [Pa]`, color = `Comportamiento curva Pmed`, shape = `Activacion`)) +
  geom_point(size = 2) +
  labs(x = "deltaPmed", y = "A10") +
  ggtitle("A10 vs. deltaPmed para PlasmaS, coloreado según 
          el comportamiento de la curva de presión media") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 0, vjust = 0))



#plot de aquellas mediciones con deltaPmed mayor a 400
sub_subset <- subset_data[subset_data$deltaPmed > 800, ]

ggplot(sub_subset, aes(x = `deltaPmed`, y =`A10 (600s+CT) [Pa]`, color = Muestra, shape = `Comportamiento curva Pmed`)) +
  geom_point(size = 2) +
  labs(x = "deltaPmed", y = "A10") +
  ggtitle("A10 vs. deltaPmed para mediciones con deltaPmed mayor a 800 Pa") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 0, vjust = 0))
```

Plot A10 vs Presión de desprendimiento
```{r}
#Plot A10 vs Presión de desprendimiento, color Muestra
ggplot(subset_data, aes(x = `Presion de desprendimiento [Pa]`, y =`A10 (600s+CT) [Pa]`, color = Muestra, shape = Activacion)) +
  geom_point(size = 2) +
  labs(x = "Presión de desprendimiento o ruptura", y = "A10") +
  ggtitle("A10 vs. Presión de desprendimiento o ruptura, coloreado por muestra") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 0, vjust = 0))

#Plot A10 vs Presión de desprendimiento, coloreado según la prueba 

# Eliminar las filas que contienen NA en "presión de desprendimiento"
sub_subset <- subset_data[complete.cases(subset_data$`Presion de desprendimiento [Pa]`), ]

ggplot(sub_subset, aes(x = `Presion de desprendimiento [Pa]`, y =`A10 (600s+CT) [Pa]`, color = Prueba, shape = Muestra)) +
  geom_point(size = 2) +
  labs(x = "Presión de desprendimiento o ruptura", y = "A10") +
  ggtitle("A10 vs. Presión de desprendimiento o ruptura, coloreado por muestra") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 0, vjust = 0))

#Plot A10 vs Presión de desprendimiento, para Sangre
sub_subset <- subset_data[subset_data$Muestra == "SANGRE", ]

ggplot(sub_subset, aes(x = `Presion de desprendimiento [Pa]`, y =`A10 (600s+CT) [Pa]`, color = Activacion)) +
  geom_point(size = 2) +
  labs(x = "Presión de desprendimiento o ruptura", y = "A10") +
  ggtitle("A10 vs. Presión de desprendimiento o ruptura, para mediciones con SANGRE") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 0, vjust = 0))
```


