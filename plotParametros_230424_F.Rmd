---
title: "Plot A10"

---

```{r}
# Discard NA's in subset_data$`Comportamiento curva Pmed`
#my_data <- my_data[!is.na(my_data$`Comportamiento curva Pmed`), ]

# Discard NA's in subset_data$`Comportamiento curva Pmed`
#my_data <- subset(my_data, `Comportamiento curva Pmed`!="NA")

# Discard cisnes in subset_data$`Comportamiento curva Pmed`
#my_data <- subset(my_data, `Comportamiento curva Pmed`!="cisne")

#eliminamos las observaciones que NO se deben considerar en el análisis
subset_data <- subset(data, `Considerar en análisis`=="si")
```
```{r}
#eliminamos mediciones sin datos de A10
subset_data <- subset_data[!is.na(subset_data$`A10 (600s+CT) [Pa]`), ]
```

```{r}
library(ggplot2)
library(dplyr)

# Create plot using ggplot2
ggplot(subset_data, aes(x = Prueba, y =`A10 (600s+CT) [Pa]`, color = Muestra, shape = Activacion)) +
  geom_point(size = 3) +
  geom_point() +
  #scale_x_continuous(limits = c(0, 2000)) +
  #scale_y_continuous(limits = c(0, 1000)) +
  labs(x = "Pruebas", y = "A10") +
  ggtitle("A10 vs. Mediciones, coloreado por muestra") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5))

subset_data$Nro_Cartucho_Factor <- factor(subset_data$`Nro Cartucho`, levels = unique(subset_data$`Nro Cartucho`))

ggplot(subset_data, aes(x = Prueba, y =`A10 (600s+CT) [Pa]`, color = Nro_Cartucho_Factor)) + 
  geom_point(size = 2) +
  ggtitle("A10 vs. Pruebas coloreado según el cartucho") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5))


#------- analisis del A10 intra-prueba (intra-día)---------

# calculate CV values for each group
cv_data <- subset_data %>%
  group_by(Prueba) %>%
  summarise(cv = round(100*sd(`A10 (600s+CT) [Pa]`)/mean(`A10 (600s+CT) [Pa]`), 0))


#para calcular el N de cada grupo/prueba
library(dplyr)

obs_data <- subset_data %>%
  count(Prueba, name = "obs")

# plot boxplot with CV labels
#se agrega otro comando "geom_text" para agrgar el N
ggplot(subset_data, aes(x = Prueba, y = `A10 (600s+CT) [Pa]`)) +
  geom_boxplot() +
  labs(x = "Prueba", y = "A10") +
  ggtitle("A10 boxplot vs pruebas (con N y CV%)") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5)) +
  geom_text(data = obs_data, aes(x = Prueba, y = min(subset_data$`A10 (600s+CT) [Pa]`), label = paste0("", obs)), vjust = -1, size = 3, color = "red") +
  geom_text(data = cv_data, aes(x = Prueba, y = min(subset_data$`A10 (600s+CT) [Pa]`), label = paste0("", cv, "%")), vjust = 1, angle =55, size = 3, color = "blue", nudge_x = -0.2)


```
```{r}
#Variación inter-día para cada muestra
# calculate CV values for each group
cv_muestra <- subset_data %>%
  group_by(Muestra) %>%
  summarise(cv = round(100*sd(`A10 (600s+CT) [Pa]`)/mean(`A10 (600s+CT) [Pa]`), 0))

#para calcular el N de caja grupo/prueba
library(dplyr)

obs_muestra <- subset_data %>%
  count(Muestra, name = "obs")

#box plot con CV y N
ggplot(subset_data, aes(x = subset_data$Muestra, y = subset_data$`A10 (600s+CT) [Pa]`)) +
  geom_boxplot() +
  labs(x = "Muestra", y = "A10") +
  ggtitle("A10 boxplot vs Muestra (con N y CV%)") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5)) +
  geom_text(data = obs_data, aes(x = subset_data$Muestra, y = min(subset_data$`A10 (600s+CT) [Pa]`), label = paste0("", obs)), vjust = -1, size = 3, color = "red") +
  geom_text(data = cv_data, aes(x = subset_data$Muestra, y = min(subset_data$`A10 (600s+CT) [Pa]`), label = paste0("", cv, "%")), vjust = 1, angle =55, size = 3, color = "blue", nudge_x = -0.2)
```

```{r}
#subseteamos según la muestra para analizar los CV del A10 inter-prueba
rotrol <- subset_data[subset_data$Muestra == "ROTROL N", ]
rotrol_25 <- subset_data[subset_data$Muestra == "ROTROL_N_25", ]
sangre <- subset_data[subset_data$Muestra == "SANGRE", ]
plasma <- subset_data[subset_data$Muestra == "PLASMA SIEMENS", ]
plasma_25 <- subset_data[subset_data$Muestra == "PLASMA_SIEMENS_25", ]
plasma_in <- plasma[plasma$Activacion == "INTEM", ]
plasma_ex <- plasma[plasma$Activacion == "EXTEM", ]
rotrol_in <- rotrol[rotrol$Activacion == "INTEM", ]
rotrol_ex <- rotrol[rotrol$Activacion == "EXTEM", ]
sangre_in <- sangre[sangre$Activacion == "INTEM", ]
sangre_ex <- sangre[sangre$Activacion == "EXTEM", ]

#subseteamos según la activación
intem <- subset_data[subset_data$Activacion == "INTEM", ]
extem <- subset_data[subset_data$Activacion == "EXTEM", ]
```
```{r}
table(intem$Muestra)
table(extem$Muestra)
```

```{r}



```


```{r}
# Convert date range to proper format
#start_date <- as.Date("2022-11-30")
#end_date <- as.Date("2023-04-05")



# SANGRE  Muestra=="ROTROL N" | Muestra=="ROTROL_N_25"   Muestra=="PLASMA SIEMENS"  PLASMA_SIEMENS_25
subset_data <- subset(subset_data, Muestra=="PLASMA SIEMENS"   )
#subset_data <- subset(subset_data, Prueba=="Dia 29")

# Muestra Prueba Medicion deltaPmed
# `A1 (60s+CT) [Pa]`    `A10 (600s+CT) [Pa]`

#tipo_muestra Medicion Prueba deltaPmed `Canal cerrado Promedio QC1 [Pa]`

# Create plot using ggplot2
ggplot(subset_data, aes(x = Medicion, y =`A10 (600s+CT) [Pa]`, color = Prueba)) +
  geom_point(size = 4) +
  geom_point() +
  #scale_x_continuous(limits = c(0, 2000)) +
  #scale_y_continuous(limits = c(0, 1000)) +
  #labs(x = "delta P med", y = "A10") +
  ggtitle("A10 vs. Medicion - Sangre") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5))

subset_data$Nro_Cartucho_Factor <- factor(subset_data$`Nro Cartucho`, levels = unique(subset_data$`Nro Cartucho`))

ggplot(subset_data, aes(x = Prueba, y =`A10 (600s+CT) [Pa]`, color = Nro_Cartucho_Factor)) + 
  geom_point(size = 4) +
  ggtitle("A10 vs. Medicion - SANGRE") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5))


# calculate CV values for each group
cv_data <- subset_data %>%
  group_by(Prueba) %>%
  summarise(cv = round(100*sd(`A10 (600s+CT) [Pa]`)/mean(`A10 (600s+CT) [Pa]`), 0))

# plot boxplot with CV labels
ggplot(subset_data, aes(x = Prueba, y = `A10 (600s+CT) [Pa]`, fill = Prueba)) +
  geom_boxplot() +
  scale_fill_discrete(guide = guide_legend(title = "Prueba")) +
  #labs(x = "Prueba", y = "A10") +
  ggtitle("Boxplot A10 SANGRE con CV%") +
  theme_bw() +
  geom_text(data = cv_data, aes(x = Prueba, y = min(subset_data$`A10 (600s+CT) [Pa]`), label = paste0("", cv, "%")), vjust = -.5, angle =0)




# Append ".dat" to file_name column
subset_data$MedicionArchivo <- paste(subset_data$Medicion, ".dat", sep = "")

```




```

